---
import { Image } from 'astro:assets';
import type { ThumbnailGridProps } from '../../types/types';

const { images, productName } = Astro.props as ThumbnailGridProps;

// Filtrar imágenes válidas
const validImages = images?.filter(img => img?.src && typeof img.src === 'object') || [];
const hasMultipleImages = validImages.length > 1;
---

{hasMultipleImages && (
  <div class="thumbnails" data-thumbnails>
    {validImages.map((imageData, index) => (
      <button
        class={`thumbnail ${index === 0 ? 'active' : ''}`}
        data-index={index}
        data-thumbnail
        aria-label={`Ver imagen ${index + 1} de ${validImages.length} - ${productName}`}
        type="button"
      >
        <Image 
          src={imageData.src}
          alt={imageData.alt}
          width={120}
          height={120}
          loading="lazy"
          class="thumbnail-image"
          format="webp"
          quality={80}
          decoding="async"
        />
      </button> 
    ))}
  </div>
)}

<style>
  .thumbnails {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(80px, 1fr));
    gap: 0.75rem;
    max-width: 100%;
    overflow-x: auto;
    padding: 2px;
  }
  
  .thumbnail {
    border: 2px solid var(--border, #F5E6D3);
    border-radius: 8px;
    overflow: hidden;
    cursor: pointer;
    background: var(--cream-2, #FAF3E0);
    transition: all 0.3s ease;
    padding: 0;
    aspect-ratio: 1;
    min-width: 80px;
    display: flex;
    align-items: center;
    justify-content: center;
  }
  
  .thumbnail-image {
    width: 100%;
    height: 100%;
    object-fit: cover;
    transition: transform 0.2s ease;
  }
  
  .thumbnail:hover {
    border-color: var(--gold, #B8860B);
    transform: translateY(-2px);
    box-shadow: 0 4px 12px var(--shadow, rgba(0, 0, 0, 0.15));
  }
  
  .thumbnail:hover .thumbnail-image {
    transform: scale(1.05);
  }
  
  .thumbnail.active {
    border-color: var(--gold, #B8860B);
    box-shadow: 0 0 0 3px rgba(184, 134, 11, 0.3);
    transform: translateY(-1px);
  }
  
  .thumbnail:focus {
    outline: 2px solid var(--gold, #B8860B);
    outline-offset: 2px;
  }
  
  .thumbnails::-webkit-scrollbar {
    height: 6px;
  }
  
  .thumbnails::-webkit-scrollbar-track {
    background: var(--cream-2, #FAF3E0);
    border-radius: 3px;
  }
  
  .thumbnails::-webkit-scrollbar-thumb {
    background: var(--gold, #B8860B);
    border-radius: 3px;
  }
  
  .thumbnails::-webkit-scrollbar-thumb:hover {
    background: var(--gold-dark, #8B6914);
  }
  
  @media (max-width: 768px) {
    .thumbnails {
      grid-template-columns: repeat(auto-fill, minmax(60px, 1fr));
      gap: 0.5rem;
    }
    
    .thumbnail {
      min-width: 60px;
    }
  }
  
  @media (max-width: 480px) {
    .thumbnails {
      grid-template-columns: repeat(auto-fit, minmax(50px, 1fr));
    }
    
    .thumbnail {
      min-width: 50px;
    }
  }
</style>