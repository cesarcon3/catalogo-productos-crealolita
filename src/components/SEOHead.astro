---
// src/components/SEOHead.astro
import { SITE_CONFIG, getFullTitle, getFullImageUrl } from '../config/site';

// Declaraciones globales para Meta Pixel (sin alterar ejecución)
declare global {
  interface Window {
    fbq?: (...args: any[]) => void;
    _fbq?: any;
  }
}

// Asegurar que fbq existe globalmente (para los scripts inline)
declare var fbq: (...args: any[]) => void;

// Sobrescribir tipo de "if (f.fbq)" dentro del script para evitar el error "void"
type FBQNamespace = {
  callMethod?: (...args: any[]) => void;
  queue?: any[];
  push?: any;
  loaded?: boolean;
  version?: string;
};


export interface Props {
  title?: string;
  description?: string;
  image?: string;
  type?: 'website' | 'article' | 'product';
  noIndex?: boolean;
}

const { 
  title, 
  description = SITE_CONFIG.description,
  image = SITE_CONFIG.defaultImage,
  type = 'website',
  noIndex = false
} = Astro.props;

// Construir título completo
const fullTitle = getFullTitle(title);

// Mejorar descripción meta si es muy genérica
const improvedDescription = description.length < 120 
  ? `${description} - Creaciones Lolita ofrece productos artesanales únicos y de calidad superior.`
  : description;

// URLs completas para meta tags
const canonicalUrl = new URL(Astro.url.pathname, SITE_CONFIG.url).toString();
const fullImageUrl = getFullImageUrl(image);

// Robots meta
const robotsContent = noIndex ? 'noindex, nofollow' : 'index, follow';

// Schema.org JSON-LD
const organizationSchema = {
  "@context": "https://schema.org",
  "@type": "LocalBusiness",
  "name": SITE_CONFIG.name,
  "legalName": SITE_CONFIG.name,
  "description": SITE_CONFIG.description,
  "url": SITE_CONFIG.url,
  "logo": getFullImageUrl(SITE_CONFIG.logo),
  "image": fullImageUrl,
  "foundingDate": "2020",
  "priceRange": "$",
  "paymentAccepted": ["Cash", "Credit Card", "Debit Card", "Bank Transfer", "Mobile Payment"],
  "currenciesAccepted": "USD,VES",
  "sameAs": [
    SITE_CONFIG.social.instagram,
    SITE_CONFIG.social.facebook
  ],
  "contactPoint": {
    "@type": "ContactPoint",
    "telephone": `+${SITE_CONFIG.phone}`,
    "contactType": "customer service",
    "availableLanguage": "Spanish"
  },
  "address": {
    "@type": "PostalAddress",
    "addressCountry": "VE",
    "addressRegion": "Venezuela"
  },
  "openingHours": SITE_CONFIG.openingHours
};
---

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

<!-- Meta Pixel Code -->
 
<script is:inline>
!function(f,b,e,v,n,t,s)
{if(f.fbq)return;n=f.fbq=function(){n.callMethod?
n.callMethod.apply(n,arguments):n.queue.push(arguments)};
if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
n.queue=[];t=b.createElement(e);t.async=!0;
t.src=v;s=b.getElementsByTagName(e)[0];
s.parentNode.insertBefore(t,s)}(window, document,'script',
'https://connect.facebook.net/en_US/fbevents.js');
fbq('init', '1476451196973992');
fbq('track', 'PageView');
</script>
<noscript><img height="1" width="1" style="display:none"
src="https://www.facebook.com/tr?id=1476451196973992&ev=PageView&noscript=1"
/></noscript>
<!-- End Meta Pixel Code -->

  
<!-- Google Tag Manager -->
<script is:inline>
(function(w, d, s, l, i) {
  (w[l] = w[l] || []).push({
    'gtm.start': new Date().getTime(),
    event: 'gtm.js'
  });

  var f = d.getElementsByTagName(s)[0];
  var j = d.createElement(s);
  var dl = l !== 'dataLayer' ? '&l=' + l : '';

  j.async = true;
  j.src = 'https://www.googletagmanager.com/gtm.js?id=' + i + dl;

  if (f && f.parentNode) {
    f.parentNode.insertBefore(j, f);
  }
})(window, document, 'script', 'dataLayer', 'GTM-5XL3FW9P');
</script>
<!-- End Google Tag Manager -->



  <!-- SEO Básico -->
  <title>{fullTitle}</title>
  <meta name="description" content={improvedDescription} />
  <meta name="keywords" content={SITE_CONFIG.keywords.join(', ')} />
  <meta name="author" content={SITE_CONFIG.name} />
  <meta name="creator" content={SITE_CONFIG.name} />
  <meta name="publisher" content={SITE_CONFIG.name} />
  <meta name="robots" content={robotsContent} />
  <link rel="canonical" href={canonicalUrl} />
  
  <!-- Open Graph / Facebook -->
  <meta property="og:type" content={type} />
  <meta property="og:url" content={canonicalUrl} />
  <meta property="og:title" content={fullTitle} />
  <meta property="og:description" content={improvedDescription} />
  <meta property="og:image" content={fullImageUrl} />
  <meta property="og:image:alt" content={`${SITE_CONFIG.name} - Productos Personalizados en MDF`} />
  <meta property="og:image:width" content="1200" />
  <meta property="og:image:height" content="630" />
  <meta property="og:image:type" content="image/jpeg" />
  <meta property="og:site_name" content={SITE_CONFIG.name} />
  <meta property="og:locale" content="es-VE" />
  
  <!-- Twitter -->
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:site" content={SITE_CONFIG.social.twitter} />
  <meta name="twitter:creator" content={SITE_CONFIG.social.twitter} />
  <meta name="twitter:url" content={canonicalUrl} />
  <meta name="twitter:title" content={fullTitle} />
  <meta name="twitter:description" content={improvedDescription} />
  <meta name="twitter:image" content={fullImageUrl} />
  <meta name="twitter:image:alt" content={`${SITE_CONFIG.name} - Productos Personalizados en MDF`} />
  
  <!-- Favicons -->
  <link rel="icon" type="image/svg+xml" href="/favicon.ico" />
  <link rel="apple-touch-icon" href="/apple-touch-icon.png" />
  <link rel="mask-icon" href="/favicon.ico" color="#D4AF37" />
  
  <!-- Verificaciones de motores de búsqueda -->
  <meta name="google-site-verification" content="A69SpffKp0bhRHGHu98sZ62XTS5_YlCwRA6myaHar2w" />
  
  <!-- FontAwesome para el botón de WhatsApp -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
  
  <!-- Generator -->
  <meta name="generator" content={Astro.generator} />
  
  <!-- Schema.org JSON-LD -->
  <script type="application/ld+json" set:html={JSON.stringify(organizationSchema)} />
  
  <!-- Google Analytics -->
  <script async src=https://www.googletagmanager.com/gtag/js?id=G-BG38JKHZDP></script>
  <script is:inline>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-BG38JKHZDP');
  </script>
  </script>
</head>